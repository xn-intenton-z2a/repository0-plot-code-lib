# PLOT_RENDERING

## Overview
This feature now not only handles dynamic plot rendering for SVG and PNG outputs but also enriches JSON exports with additional metadata. The JSON response now includes a metadata object with a timestamp indicating when the plot was generated and the library version read from package configuration. This enhancement improves traceability, debugging, and integration with external systems while preserving all existing functionalities like customizable axis labels, curve smoothing, dynamic color gradients, adaptive resolution, and error handling.

## Implementation
- In the /plot endpoint in src/lib/main.js, update the JSON export branch: when the query parameter jsonExport is set to "true", the computed plot data object is augmented with a new "metadata" field.
  - The metadata object includes:
    - a "timestamp" field generated by new Date().toISOString()
    - a "version" field obtained by reading the version from package.json. If reading the version fails, the system will use a default version string.
- Retain all existing functionality:
  - Dynamic SVG axis labeling and ARIA accessibility.
  - Adaptive resolution and curve smoothing using either a polyline or a smooth path via quadratic Bezier curves.
  - Dynamic color gradient support when the "colorGradient" flag is enabled, with customizable gradient start and end colors.
  - Customization options via query parameters or CLI flags to adjust dimensions, axis labels, styling, and positioning.
- Maintain detailed error handling in JSON mode with clear messages if evaluation or file read errors occur.

## Testing
- Update tests in tests/unit/http.test.js and tests/unit/main.test.js to verify that when jsonExport is requested, the JSON response contains a "metadata" object with valid "timestamp" and "version" keys.
- Add tests to check that if package.json reading fails, the metadata version defaults to a predefined string.
- Ensure that non-JSON outputs (SVG and PNG) remain unaffected by the metadata enrichment.

## Impact
By enriching JSON exports with runtime metadata, users can better integrate the library with external systems, simplify debugging of plot generation, and ensure consistency with software versioning. This improvement aligns with the library's mission to be the go-to tool for formula visualisations by delivering greater output reliability and traceability.