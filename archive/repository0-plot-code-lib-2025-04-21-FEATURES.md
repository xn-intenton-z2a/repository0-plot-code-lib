features/INTERACTIVE.md
# features/INTERACTIVE.md
# INTERACTIVE Feature Enhancement

This feature introduces an interactive mode in the CLI tool. When the user provides the `--interactive` flag, the tool will prompt for any missing parameters (such as mathematical expression, range, and output file type) via the command line.

## Overview

- **Interactive Mode Trigger:** When the `--interactive` flag is provided, the tool will check if all required parameters (`--expression`, `--range`, `--file`) are present. If not, it will prompt the user to enter them interactively.
- **Seamless Fallback:** If the user provides all parameters explicitly, the interactive mode will not interfere. It only activates when necessary.
- **User Convenience:** This mode provides a more friendly experience for users who are less comfortable with supplying command-line arguments or want to experiment with different inputs quickly.
- **Integration:** Changes remain confined to the source file, test file, and README file content without adding new files, keeping the repository compact and focused.

## Implementation Details

### Source Code Changes (src/lib/main.js)

- **Argument Parsing:** Update the argument parser to check if the `--interactive` flag is present. 
- **Interactive Prompt:** If `--interactive` is active and any of `--expression`, `--range`, or `--file` are missing, use Node’s `readline` module to prompt the user for input.
- **Input Validation:** Validate the received input similarly as in the non-interactive mode. 
- **Processing Flow:** Once all required parameters are available (either from command-line or interactive input), proceed with the usual processing (CSV, PNG, or SVG generation).

### Test Enhancements (tests/unit/main.test.js)

- **Simulating Interactive Mode:** Add tests that simulate the interactive mode by mocking `readline` and its input/output to ensure prompts are displayed and that the provided user inputs are processed correctly.
- **Non-blocking Behavior:** Ensure that when `--interactive` is provided along with complete parameters, the behavior remains unchanged.

### Documentation Updates (README.md)

- **Usage Instructions:** Update the README to document the new `--interactive` flag. Include examples such as:
  ```sh
  node src/lib/main.js --interactive
  ```
- **Interactive Flow Description:** Explain that if certain parameters are omitted, the CLI will prompt the user to input them, and it will validate the responses using the same logic as direct CLI parameters.

## Conformance with Mission and Guidelines

- **Mission Alignment:** This feature helps make the CLI more user-friendly, lowering the barrier for new users to generate plots from mathematical expressions.
- **Repository Guidelines:** All changes are confined to modifying existing files (source, tests, README), ensuring compliance with repository standards.

By merging interactive input capabilities into the CLI, users gain a more accessible and exploratory workflow, enhancing overall usability without compromising on the minimalistic approach.features/STATS.md
# features/STATS.md
# STATS Feature Enhancement

This update fully integrates the `--stats` flag into the CLI tool. When enabled, the tool will compute and display basic statistics for each mathematical expression’s computed y-values. This includes the minimum, maximum, and average values. This enhancement provides immediate insights to users on the data generated by their expressions, supporting the mission of being a go-to tool for formula visualisations.

## CLI Parameter Parsing & Validation

- Extend the CLI schema in `src/lib/main.js` to include a new optional boolean parameter `stats`. For example, add:

  ```js
  stats: z.boolean().optional()
  ```

- Update the argument parsing logic to recognize the `--stats` flag.

## Implementation Details

- After evaluating the y-values for each expression and populating `yValuesArray`, check if the `stats` flag is active.
- For each set of y-values, compute:
  - **Minimum Value:** using `Math.min(...yValues)`
  - **Maximum Value:** using `Math.max(...yValues)`
  - **Average Value:** by summing the values and dividing by the count.
- Output the computed statistics to the console, formatted with clear labels for each expression. This statistics output should be printed before proceeding to export or plotting routines.

## Testing Enhancements

- Update the test suite in `tests/unit/main.test.js` to include tests that verify the following:
  - When the `--stats` flag is provided, the console output includes a statistics summary for each expression.
  - The statistics are correctly computed and formatted, even when multiple expressions are provided.

## Documentation Updates

- Update the `README.md` to document the new `--stats` flag. Explain that when this flag is enabled, the CLI prints summary statistics (min, max, average) for computed y-values.

## Dependency and Build Consistency

- No new dependencies are required. The changes remain fully compatible with Node 20 and ECMAScript modules.
- Ensure that these modifications conform to the guidelines outlined in `CONTRIBUTING.md` and reflect the mission in `MISSION.md`.
features/DATA_LABEL.md
# features/DATA_LABEL.md
# DATA_LABEL Feature Enhancement

This feature adds a new CLI flag, `--data-label`, which enables the display of numeric labels next to each plotted data point in the generated SVG (and PNG) output. When activated, the tool annotates each marker with its corresponding y-value (or the data value) in a small text element positioned nearby. This enhancement provides immediate data insight directly on the plot and increases the interpretability of the visualization.

# Overview

- **Objective:** Allow users to quickly see the value of each data point without having to infer it from the axis scales.
- **Benefit:** Improves usability when precise values are required, aiding in data analysis and presentation.
- **Usage Example:**
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --file output.svg --data-label true
  ```

# Implementation Details

- **Source Code Changes (src/lib/main.js):**
  - Extend the simple CLI argument parser to include a new optional flag `--data-label` (boolean). When the flag is present, store a variable (e.g. `dataLabel = true`).
  - In the SVG (and PNG) generation branch, after drawing the marker (circle) for each data point, add a corresponding `<text>` SVG element that displays the y-value (or other desired value) near the marker. Positioning should be offset slightly to avoid overlap with the marker.
  - Ensure that the inclusion of text labels does not interfere with the existing structure of the SVG and that it scales appropriately with different numbers of points and marker sizes.

- **Error Handling & Fallbacks:**
  - If an invalid value is provided for `--data-label`, default to no labels.
  - Maintain full backward compatibility when this flag is not provided.

# Testing Enhancements

- **Test File Updates (tests/unit/main.test.js):**
  - Add test cases that simulate running the CLI with the `--data-label` flag enabled.
  - Verify that when the flag is active, the generated SVG string contains additional `<text>` elements corresponding to data point labels. These elements should include numerical values that match (or approximate) the computed y-values.
  - Ensure that when `--data-label` is not provided, no such `<text>` elements (beyond the title and axis labels) are present near the markers.

# Documentation Updates

- **README.md:**
  - Update the documentation to include a section describing the new `--data-label` flag.
  - Provide a usage example and explain that enabling this feature will annotate each data point with its numeric value.
  - Explain any limitations or recommended usage scenarios (e.g. using it with a moderate number of data points to avoid clutter).

# Conformance with Mission and Guidelines

- This enhancement is fully achievable within the current repository as it only changes the source file, test file, README, and if needed, minor updates to dependencies. It adheres to the repository guidelines and reinforces the mission to provide precise, go-to visualizations for mathematical expressions.
features/HISTORY_LOG.md
# features/HISTORY_LOG.md
# HISTORY_LOG Feature Enhancement

This feature introduces a new CLI flag `--history` that enables persistent logging of every CLI invocation. When users run the tool with the `--history` flag, all the command-line arguments (along with a timestamp) are appended to a history log file (e.g. `plot_history.log`) in the current working directory. This addition allows users to track previous commands, review their inputs, and easily reproduce plots.

## Overview

- **Objective:** Automatically record CLI invocation details when the `--history` flag is provided.
- **Benefit:** Users can review and reuse previous commands. This enhances reproducibility and debugging by keeping a historical record of generated plots.
- **Usage Example:**
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --file output.svg --history
  ```

## Implementation Details

- **Source Code Changes (src/lib/main.js):**
  - Parse a new flag `--history` in the argument loop.
  - After a successful plot/data generation, if the flag is active, append a log entry to a file (e.g. `plot_history.log`).
  - The log entry should include a timestamp and a serialized string of the arguments or a summary of the action performed.
  - Ensure that logging does not interfere with the existing output of CSV, SVG, PNG, etc.

- **Test Enhancements (tests/unit/main.test.js):**
  - Add tests to simulate invoking the CLI with the `--history` flag.
  - Verify that after execution, the history log file exists and contains an entry with the expected content (timestamp and command-line parameters).
  - Clean up the history file in test setup/teardown if necessary.

- **Documentation Updates (README.md):**
  - Update the README to include a section on history logging.
  - Provide examples and instructions indicating that using `--history` will log the command for later reference. For example:
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --file output.svg --history
  ```
  - Explain that the log file (named `plot_history.log`) is created in the working directory and can be reviewed to see previous CLI invocations.

## Conformance with Mission and Guidelines

- All changes remain confined to existing source files, test files, and the README.
- This feature is distinct and achievable in the repository; it provides additional user value and aids reproducibility without requiring a grandiose modification of the codebase.features/PDF_EXPORT.md
# features/PDF_EXPORT.md
# PDF_EXPORT Feature Enhancement

This feature introduces PDF export capabilities to the CLI tool. Leveraging the already included PDFKit library, users can now output their generated plots as PDF files by using the `--pdf` flag. This enhancement provides an additional export option to complement the existing SVG and PNG outputs, aligning with the mission to be a versatile plot library.

# Overview

- Introduce a new CLI flag `--pdf` to enable PDF export of the generated plots.
- Utilize PDFKit to create a PDF document from the plot data and output it as a file.
- Ensure that the PDF export does not interfere with the existing functionalities (e.g., `--svg`, `--png`, `--expression`, `--range`, `--stats`).

# CLI Integration

- Update the argument parsing in `src/lib/main.js` to recognize the `--pdf` flag. For example, extend the zod schema with:

  ```js
  pdf: z.boolean().optional()
  ```

- Modify the main execution branch to check if the `--pdf` flag is active, and if so, invoke the PDF generation routine.

# Implementation Details

- **Source Code Modifications:**
  - In `src/lib/main.js`, after computing the plot data, check for the presence of the `--pdf` flag.
  - Use PDFKit to create a PDF document. The PDF output should include a basic rendering of the plot (e.g., plot title, computed data, and any graphical representation available from the in-memory plot generation).
  - Ensure proper resource handling by piping the PDF output to a file stream (the filename can be derived from the provided `--file` parameter or a default name such as `output.pdf`).

- **Error Handling:**
  - Provide clear error messages if PDF generation fails or if PDFKit encounters issues.

# Testing Enhancements

- **Unit Tests:**
  - Update `tests/unit/main.test.js` to simulate CLI invocation with the `--pdf` flag.
  - Verify that when the flag is provided, the PDF generation routine is triggered (this may be validated via logging or by checking for expected function calls).
  - Ensure that the addition of the PDF export does not break existing tests.

# Documentation Updates

- **README.md:**
  - Add a section describing the new `--pdf` flag and how to use it. Include an example command such as:
    ```sh
    node src/lib/main.js --expression "y=sin(x)" --range "x=-10:10" --pdf --file output.pdf
    ```
  - Explain that when using the `--pdf` flag, the tool will generate a PDF using PDFKit.

# Dependency and Compliance

- No additional dependencies are required since PDFKit is already present in the repository.
- All changes conform to the guidelines (source, tests, README, dependencies) and are in line with the mission of providing comprehensive CLI visualisations as a go-to plot library.
features/FLAG_PARSER.md
# features/FLAG_PARSER.md
# FLAG_PARSER Feature Enhancement

This feature consolidates the processing of CLI flags into a unified flag parser using the zod library. The update enhances the usability of the CLI by ensuring robust, validated parsing across all supported flags (e.g. --help, --stats, --diagnostics, --expression, --range, --file). This consolidation streamlines feature interactions and improves error handling, while staying within the repository guidelines of only modifying existing source, tests, README, and dependencies files.

## Implementation Details

- **Source Code Updates (src/lib/main.js):**
  - Import the zod library to define a CLI schema for validating and parsing command-line arguments.
  - Define a schema with optional flags: `--help` (boolean), `--stats` (boolean), `--diagnostics` (boolean), `--expression` (string), `--range` (string), and `--file` (string).
  - Update the main function to parse `process.argv` using the defined schema. If the schema validation fails, display a clear error message along with a usage guide.
  - Route the control flow based on the presence or absence of the flags. For instance, if `--help` is detected, output comprehensive usage instructions and exit without further processing.

## Testing Enhancements

- **Test File Updates (tests/unit/main.test.js):**
  - Add tests to check that the CLI parser correctly handles valid and invalid flag combinations.
  - Verify that when a valid flag is passed (e.g., `--help`), the expected behavior and output are produced.
  - Ensure the parser gracefully catches errors for incorrect flag formats, providing the informative usage guide as feedback.

## Documentation Updates

- **README.md:**
  - Update the README to document the updated CLI interface, including details on each supported flag and their usage examples. For example:

    ```sh
    node src/lib/main.js --expression "y=sin(x)" --range "x=-10:10" --file output.svg
    ```

  - Provide a section on flag validations and error messaging.

## Dependency and Build Consistency

- No external dependencies beyond the already included zod are required. The updates remain compliant with Node 20 and ECMAScript module standards.
- All modifications adhere to the repository's contribution guidelines as specified in CONTRIBUTING.md and support the mission of being a go-to CLI tool for formula visualisations.
features/CUSTOM_STYLE.md
# features/CUSTOM_STYLE.md
# CUSTOM_STYLE Feature Enhancement

This feature adds custom styling options for the generated plot output. Users can now supply additional CLI flags to control the appearance of the plot line and the background color of the SVG canvas. This enhancement is useful for personalizing plots without altering the core functionality.

## Overview

- **Objective:** Allow users to customize plot colors via new CLI options `--line-color` and `--bg-color`.
- **Benefit:** Users can immediately tailor the look of their generated SVG or PNG without post-processing, making the CLI tool more flexible and visually appealing.
- **Usage:** When generating plots that are not CSV, users can include extra flags to change the polyline stroke color and the background fill color.

Example usage:

```sh
node src/lib/main.js --expression "y=sin(x)" --range "x=-1:1" --file output.svg --line-color "green" --bg-color "#f0f0f0"
```

## Implementation Details

### Source Code Modifications

- **Argument Parsing:**
  - Update the CLI argument parser in `src/lib/main.js` to recognize two new optional flags: `--line-color` and `--bg-color`.
  - Store these values in variables (e.g., `lineColor` and `bgColor`). If not provided, default to `blue` for the plot line and no background color (or default white) for the background.

- **SVG Generation Updates:**
  - In the branch that generates the SVG content (when file extension is not `.csv` and not `.png`), prepend an SVG rectangle covering the full canvas to serve as the background and set its fill to the provided `bgColor`.
  - Update the `<polyline>` element to use `stroke="{lineColor}"` instead of the hard-coded blue color.
  - Preserve existing functionality for drawing axes, data points, and text.

### Test Enhancements

- Update `tests/unit/main.test.js` to add tests verifying that when the `--line-color` and `--bg-color` flags are provided, the generated SVG content includes the specified colors.
  - For example, after calling `main` with these flags, check that the resulting SVG string contains the substrings `stroke="green"` and `fill="#f0f0f0"` (or similar based on the provided test colors).

### Documentation Updates

- **README.md:**
  - Add a section to document the new CLI flags with usage examples and descriptions:

    ```sh
    node src/lib/main.js --expression "y=sin(x)" --range "x=-1:1" --file output.svg --line-color "green" --bg-color "#f0f0f0"
    ```

  - Explain that `--line-color` sets the color of the connecting polyline, and `--bg-color` sets the background color of the SVG canvas.

## Conformance with Guidelines

- All modifications are confined to the source file, test file, and README file as per repository contribution guidelines.
- This feature is distinct from existing ones and provides immediate, achievable value by enhancing visual customization directly in the CLI.
features/JPG_EXPORT.md
# features/JPG_EXPORT.md
# JPG_EXPORT Feature Enhancement

This feature adds support for exporting plots as JPEG images. Currently, the CLI tool supports CSV, SVG, and PNG outputs. With the addition of JPEG export, users have another widely supported image format to choose from.

# Overview

- **Objective:** Enable users to generate JPEG images by specifying an output file with the ".jpg" extension.
- **Benefits:** Provides additional flexibility and compatibility by offering JPEG output, appealing to users who prefer or require that format.
- **Integration:** The CLI argument parser in `src/lib/main.js` will be updated to detect when the output filename ends with `.jpg`. When detected, the tool will generate SVG content as before and use Sharp's `jpeg()` method to convert the SVG buffer into JPEG format.

# Implementation Details

- **Source Code Changes:**
  - In `src/lib/main.js`, add an additional condition in the output file type check. For files ending with `.jpg`, convert the generated SVG content to a JPEG buffer using Sharp:
    ```js
    if (outputFile.endsWith(".jpg")) {
      const svgContent = `<svg><text x='10' y='20'>Expression: ${expression}</text><text x='10' y='40'>Range: ${range}</text></svg>`;
      try {
        const buffer = await sharp(Buffer.from(svgContent)).jpeg().toBuffer();
        fs.writeFileSync(outputFile, buffer);
        console.log(`JPEG file generated: ${outputFile}`);
      } catch (err) {
        console.error(`Error creating JPEG file ${outputFile}:`, err);
      }
    }
    ```

- **Testing Enhancements:**
  - Update the test suite in `tests/unit/main.test.js` to include tests for JPEG file generation.
  - Verify that when `--file` ends with `.jpg`, a file is generated and its buffer starts with the JPEG signature (bytes: `0xFF, 0xD8, 0xFF`).

- **Documentation Updates:**
  - Update `README.md` to document the new `--file` behavior for JPEG export. For example:
    ```sh
    node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --file output.jpg
    ```

# Conformance with Mission and Guidelines

This feature is fully compatible with existing modifications limited to source files, tests, and documentation. It extends the plot library's export capabilities, aligning with the mission of being a go-to plot library that offers diverse output options.
features/ASCII_PLOT.md
# features/ASCII_PLOT.md
# ASCII_PLOT Feature Enhancement

This feature introduces a new CLI flag, `--ascii`, which enables the tool to output a simple ASCII-based plot of the computed time series data directly to the console. This provides users with a quick, textual preview of their plotted data without needing to generate external files (like SVG or PNG).

# Overview

- **Objective:** Provide a fast and lightweight visualization option via ASCII art, allowing users to quickly inspect the trend of their data in the terminal.
- **Benefit:** Enhances accessibility of the CLI tool by offering an immediate, low-overhead visual representation that complements file-based outputs.

# CLI Parameter Parsing & Validation

- Extend the argument parser in `src/lib/main.js` to include an optional boolean flag `--ascii`.
- When the `--ascii` flag is detected, the tool bypasses (or complements) file generation to instead output an ASCII plot to stdout.
- Ensure that the flag is mutually exclusive with any conflicting output mode if required (or simply add to the output without interfering with other functionalities).

# Implementation Details

- **Data Processing:** 
  - Generate the time series data as usual from the provided mathematical expression and range.
  - Determine the minimum and maximum y-values to set up a vertical scale (for example, a fixed height of 20 rows).
  - Map each computed y-value to a corresponding row index based on the scale.
- **ASCII Plot Generation:**
  - For each data point, create a line of text of fixed width (e.g., 50 characters).
  - Place a marker character (such as `*`) at the horizontal position corresponding to the normalized y-value.
  - Other positions can be filled with spaces to form a simple visual plot.
- **Output:**
  - Print the generated ASCII plot line-by-line to stdout.

# Testing Enhancements

- Update the unit tests in `tests/unit/main.test.js` to include a scenario where the `--ascii` flag is provided.
- Verify that the console output contains expected ASCII chart patterns (e.g., presence of `*` characters arranged in a line plot).
- Ensure that no file write operations occur when the `--ascii` flag is active (or if combined, that the ASCII output is clearly printed to stdout).

# Documentation Updates

- Update `README.md` to document the new `--ascii` flag with usage examples:
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --ascii
  ```
- Explain that this flag provides an immediate, text-based visualization of the computed time series data.

# Conformance with Mission and Guidelines

- The ASCII_PLOT feature aligns with the mission to be a go-to plot library by adding a quick, alternative visualization mode.
- All modifications are confined to existing source files, test files, the README, and dependency files if needed, adhering to repository contribution guidelines.
- This feature is distinct and enhances usability without overlapping existing features like SVG, PNG, or JSON exports.features/HELP.md
# features/HELP.md
# HELP Feature Addition

This feature introduces a `--help` flag to the CLI tool that, when invoked, displays complete usage instructions and examples to the user. This is designed to improve usability and provide quick guidance on how to operate the tool.

## Implementation Details

- **Source Code (src/lib/main.js):**
  - Update the main function to check for the presence of the `--help` flag in the command-line arguments.
  - If the flag exists, print a detailed help message explaining the available flags (`--expression`, `--range`, `--file`, `--stats`, `--diagnostics`, etc.) along with an example usage guide.
  - Terminate the execution after displaying help to prevent further processing.

- **Testing Enhancements (tests/unit/main.test.js):**
  - Add a test case that simulates running the CLI with the `--help` flag.
  - Verify that the output includes key phrases from the help message (e.g. "Usage", "--help", and example command formats).

- **Documentation Updates (README.md):**
  - Update the README to include a section on the `--help` flag.
  - Provide an example command (e.g., `node src/lib/main.js --help`) and indicate the expected output.

## Conformance with Guidelines

- The changes are confined to the required files (source, test, README, and, if needed, package.json for dependency consistency).
- This feature adheres to the repository guidelines by enhancing the CLI interface without relying on grandiose changes or external dependencies.
- The added help functionality complements other CLI features like `--stats` and `--diagnostics`, ensuring a consistent user experience.

## Example Usage

```sh
node src/lib/main.js --help
```

Upon executing the command above, users will see a help message that details the available CLI options and usage examples.
features/HTML_EXPORT.md
# features/HTML_EXPORT.md
# HTML_EXPORT Feature Enhancement

This feature introduces an option to export the generated plot as a complete HTML document. When the CLI is invoked with an output file that ends with ".html", the tool will wrap the existing SVG output within a minimal HTML structure. This allows users to open the file directly in a browser and interact with the plot without needing to embed the SVG manually.

## Overview

- **Objective:** Provide an extra export format that delivers a self-contained HTML file embedding the SVG plot.
- **Benefit:** Users can quickly preview and share plots in a web-friendly format without additional steps.

## Implementation Details

### Source File Changes (src/lib/main.js):

- **Output File Detection:** Update the main function to check if the `--file` argument ends with ".html".
- **HTML Wrapping Logic:**
  - If an HTML export is requested, call the existing SVG generation routine to produce the SVG string.
  - Wrap the SVG string in a basic HTML5 template. For example:
    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Plot Output</title>
      <style>
        body { margin: 0; padding: 0; display: flex; align-items: center; justify-content: center; background-color: #fff; }
      </style>
    </head>
    <body>
      <!-- Embedded SVG -->
      {{SVG_CONTENT}}
    </body>
    </html>
    ```
  - Replace `{{SVG_CONTENT}}` with the generated SVG content.
- **File Writing:** Write the resulting HTML string to the specified file path.

### Testing Enhancements (tests/unit/main.test.js):

- **New Test Cases:** Add tests to simulate the CLI invocation with `--file output.html` and verify that:
  - The output file contains a standard HTML structure (e.g., contains `<!DOCTYPE html>` and `<html>` tags).
  - The embedded SVG content is present in the output.

### Documentation Updates (README.md):

- Add a section describing the new `--html` export option:

  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=-1:1" --file output.html
  ```

- Explain that when the output file has a `.html` extension, the tool generates a complete HTML document embedding the SVG plot. This allows for easy preview in web browsers.

## Conformance with Guidelines

- **Scope:** The changes are confined to the source file, test file, README file, and (if necessary) minor updates in the dependencies file.
- **Mission Alignment:** This enhancement contributes to making our CLI the go-to tool for formula visualisations by offering versatile and immediately viewable output formats.
- **Achievability:** The feature is achievable in a single repository and aligns with existing export functionalities without overlapping them.
features/SVG_ANIMATE.md
# features/SVG_ANIMATE.md
# SVG_ANIMATE Feature Enhancement

This feature introduces an optional animation mode for SVG plots. When the CLI tool is invoked with the new `--animate` flag, the generated SVG output will include basic animation elements to enhance the visual appeal of the plot. This animated SVG can be used for presentations or to provide an interactive preview in browsers.

## Overview

- **Objective:** Add a simple animation to the SVG plot by injecting SVG `<animate>` elements into the polyline that connects data points.
- **Benefit:** Enhances user experience by allowing dynamic visualizations directly from the CLI without additional post-processing.
- **Usage Example:**
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --file animated.svg --animate
  ```

## Implementation Details

### Source Code Changes

- **Argument Parsing:**
  - Update the CLI parser in `src/lib/main.js` to detect the `--animate` flag. Set a corresponding variable (e.g., `animate = true`).

- **SVG Generation Enhancement:**
  - In the `generateSvgContent` function, check if the `animate` flag is active.
  - If active, modify the generated `<polyline>` element to include an `<animate>` child element. For example, insert:
    ```xml
    <animate attributeName="stroke-dashoffset" from="0" to="10" dur="2s" repeatCount="indefinite" />
    ```
    so that the polyline animates continuously.

### Test Enhancements

- Add tests in `tests/unit/main.test.js` to simulate invoking the CLI with the `--animate` flag. Verify that:
  - The generated SVG string contains an `<animate` tag within the polyline element
  - Other SVG elements (e.g., axes, markers) are still present.

### Documentation Updates

- Update the `README.md` to include a section documenting the new `--animate` flag, similar to the following example:
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --file animated.svg --animate
  ```
- Explain that this flag adds animation to the plotted data, making the visualization more engaging.

## Conformance with Mission and Guidelines

- **Repository Impact:** All changes are confined to modifying existing source files, test files, and the README file.
- **Achievable Scope:** This feature is a small, incremental enhancement that provides immediate user value and distinguishes the library as a dynamic plotting tool.
- **Mission Alignment:** By enabling animated SVG plots, the library further positions itself as the "go-to plot library" with unique, interactive capabilities.
features/PLOT.md
# features/PLOT.md
# PLOT Feature Enhancement

This update refines the PLOT feature by adding robust CLI argument parsing, parameter validation, and improved error handling. This ensures users receive clear guidance for command usage.

# CLI Argument Parsing & Validation

- Update `src/lib/main.js` to parse CLI arguments for the following parameters:
  - `--expression`: A mathematical expression string (e.g., "y=sin(x)").
  - `--range`: A range in the format "x=start:end,y=start:end". Validate the format using a robust library or custom regex ensuring both parts are present.
  - `--file`: A file path where the plot output (e.g., SVG) is confirmed to be generated.

- Implement clear error messages in cases of missing or improperly formatted parameters.

- Include a usage guide that is printed when the argument input is invalid or incomplete. This guide should illustrate the correct command usage:

```sh
node src/lib/main.js --expression "y=sin(x)" --range "x=-10:10,y=-1:1" --file output.svg
```

# Test Enhancements

- Update `tests/unit/main.test.js` to include tests for:
  - Successful execution when valid parameters are passed.
  - Cases where one or more parameters are missing or badly formatted, ensuring the appropriate error message is produced.

# Documentation Updates

- Update the README.md to reflect the enhanced CLI usage, including updated examples and detailed explanation of parameter formats and error cases.

# Dependency and Code Integrity

- Ensure that all updates remain compatible with Node 20 and ESM standards.
- Leverage existing dependencies (e.g., zod) if needed for parameter validation.
- Confirm that changes remain compliant with `CONTRIBUTING.md` guidelines and minimal file modifications, affecting only source, tests, README, and package.json if necessary.

This enhancement consolidates the PLOT feature by providing a more resilient and user-friendly CLI interface, directly aligning with the mission to be the go-to plot library for formula visualisations.
features/EXPRESSION_EXT.md
# features/EXPRESSION_EXT.md
# Expression Extension Enhancement

This update extends the expression evaluation support within the CLI tool. In addition to the original `y=sin(x)` functionality, the CLI now supports additional trigonometric expressions: `y=cos(x)` and `y=tan(x)`. This enhancement aligns with our goal of being a go-to plot library by providing users with more flexibility in generating time series data from simple mathematical expressions.

## Overview

- **Extended Expression Support:** The CLI now recognizes and evaluates `y=cos(x)` using `Math.cos(x)` and `y=tan(x)` using `Math.tan(x)`, in addition to the existing `y=sin(x)` evaluation. Any unsupported expression defaults to `y=0`.
- **User Benefit:** Users can now generate time series data for cosine and tangent functions, offering a broader set of mathematical visualizations without requiring changes to the expression input format.

## Implementation Details

### Source Code Changes (src/lib/main.js)

- **Function Update:** Modify the `generateTimeSeriesData` function to recognize multiple expressions. Update the conditional logic as follows:
  ```js
  if (expression === "y=sin(x)") {
    y = Math.sin(x);
  } else if (expression === "y=cos(x)") {
    y = Math.cos(x);
  } else if (expression === "y=tan(x)") {
    y = Math.tan(x);
  } else {
    // Default behavior for unsupported expressions
    y = 0;
  }
  ```
- **Error Handling:** Ensure that the function still throws an error if the range format is invalid.

### Test Enhancements (tests/unit/main.test.js)

- **Extended Tests:** Add test cases to validate that when the CLI is invoked with `--expression "y=cos(x)"` or `--expression "y=tan(x)"`, the generated data reflects the appropriate mathematical evaluation. Verify that the computed `y` values are within the expected numerical bounds.

### Documentation Updates (README.md & MISSION.md)

- **README Update:** Include examples in the README demonstrating usage of the new expressions. Example:
  ```sh
  node src/lib/main.js --expression "y=cos(x)" --range "x=0:6.28" --file output.svg
  ```
- **Mission Alignment:** Update mission and contributing documents to reference the new expression capabilities, underscoring our commitment to versatile formula visualization.

## Conformance with Guidelines

- The changes are confined to the source file, tests, and documentation, adhering to repository guidelines.
- This enhancement is achievable within the current repository scope and is distinct from existing features.

## Usage Example

- For sine:
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --file output.csv
  ```
- For cosine:
  ```sh
  node src/lib/main.js --expression "y=cos(x)" --range "x=0:6.28" --file output.csv
  ```
- For tangent:
  ```sh
  node src/lib/main.js --expression "y=tan(x)" --range "x=0:6.28" --file output.csv
  ```

This update further strengthens our library's flexibility in generating plots from mathematical expressions.
features/THEME.md
# features/THEME.md
# THEME Feature Enhancement

This feature adds a new CLI flag `--theme` to allow users to select a predefined visual theme for the generated plots. Instead of manually specifying individual style options such as line color or background color, users can choose from a set of predefined themes (e.g. DARK, LIGHT, SOLARIZED) that automatically set consistent styling for the SVG or PNG output.

## Overview

- **Objective:** Enable users to easily switch between predefined visual styles with a single flag, making the plots immediately more aesthetically consistent.
- **Benefit:** Reduces the need for multiple custom style flags. It enhances user experience by offering a set of polished themes that update background, axis, and plot colors automatically.
- **Usage Example:**
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=-1:1" --file output.svg --theme DARK
  ```

## Implementation Details

### Source Code Changes (src/lib/main.js)

- **CLI Flag Addition:**
  - Extend the simple argument parser to detect `--theme` followed by a theme name (case-insensitive). Valid options include: `dark`, `light`, and `solarized`.

- **Style Overrides:**
  - When a theme is specified, override default styling parameters. For example:
    - **Dark Theme:** Set background fill to a dark color (e.g. `#222`), line color to a bright color (e.g. `#4CAF50`), and axis labels to light colors.
    - **Light Theme:** Use a white or light background with dark text and lines as defaults.
    - **Solarized Theme:** Apply a solarized palette for background, text, and plot elements.

- **Plot Generation Adjustments:**
  - In the SVG generation branch, check if a theme is provided and insert corresponding `<text>` elements for titles and adjust `<line>`, `<polyline>`, and `<circle>` attributes with theme-specific colors.
  - If the output file is PNG, the generated SVG (with theme-based styling) will be converted via sharp.

### Test Enhancements (tests/unit/main.test.js)

- **New Test Cases:**
  - Add tests to simulate CLI invocation with the `--theme` flag and verify the produced SVG content contains the expected theme-specific color values (e.g., for DARK theme, verify that the background or axis elements have the dark color code).
  - Confirm that when a theme is provided along with other custom style flags (if any), the theme takes precedence.

### Documentation Updates (README.md)

- Update the README to include a section on theme selection.
- Provide usage examples and describe the available themes and their visual effects.

## Conformance with Mission and Guidelines

- **Compliance:** All modifications are confined to updating source files, tests, and documentation. No new files are created or deleted.
- **Mission Alignment:** This feature supports the mission of being a go-to plot library by enhancing the aesthetic and usability of plot outputs through thematic visualization options.

features/PREVIEW.md
# features/PREVIEW.md
# PREVIEW Feature Enhancement

This feature introduces a new `--preview` CLI flag that launches an interactive web preview server for the generated plot. When users invoke the CLI with the `--preview` flag (in combination with the usual expression, range, and file options), the tool will spin up a lightweight HTTP server using Express to display the rendered SVG (or placeholder plot) directly in a browser.

## Overview

- **CLI Flag Addition:** Introduce the `--preview` flag to the argument parser in `src/lib/main.js`.
- **Express Integration:** Utilize the already available `express` dependency to create a simple HTTP server.
- **Interactive Preview:** When `--preview` is active, the server will render a web page containing a preview of the plot generated from the provided mathematical expression and range.
- **Non-Blocking Behavior:** If both `--file` and `--preview` are provided, the tool will generate the file as usual and additionally open the preview server.

## Implementation Details

### Source Code Changes (src/lib/main.js)

- **Flag Detection:** Extend the argument parsing logic in `main()` to detect the `--preview` flag.
- **Express Server Setup:**
  - Import Express. For example:
    ```js
    import express from 'express';
    ```
  - If the `--preview` flag is active, initialize an Express server on a configurable port (defaulting to 3000).
  - The server will serve a simple HTML page embedding the plot (for now, a placeholder SVG or text message such as "Preview of generated plot").
  - Include a route (e.g. `/`) that returns the HTML content. Optionally, log the URL to the console.
- **Flow Integration:**
  - Maintain current functionality (e.g. statistics, diagnostics, expression evaluation, and plotting) and add the preview as an additional output channel.
  - Ensure that if the preview is active, the main execution does not block the CLI but continues to run the preview server until manually terminated.

### Test Enhancements (tests/unit/main.test.js)

- Add tests to simulate running the CLI with the `--preview` flag. The tests should verify that:
  - When `--preview` is passed, no errors occur during server startup.
  - A log message indicating the preview URL is produced (or a function responsible for starting preview is called).

### Documentation Updates (README.md)

- Update the README to introduce the new `--preview` flag. For example:

  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=-10:10" --preview
  ```

- Provide instructions on how to access the preview (e.g. navigate to http://localhost:3000 in a browser) and mention configuration details if any (like changing the server port via an environment variable).

## Dependency and Build Consistency

- No additional dependencies are required as `express` is already included.
- The changes conform to Node 20 and ECMAScript module standards.
- All modifications adhere to the repository guidelines (only modifying existing source files, tests, README, and dependencies file if necessary).

## Conformance with the Mission

This feature reinforces the mission of being a go-to plot library by enabling users to quickly visualize their formula outputs in an interactive manner, akin to a live demo. It complements the existing CLI functionalities and makes the tool more user-friendly.features/SVG_PLOT.md
# features/SVG_PLOT.md
# SVG_PLOT Feature Enhancement

This feature enhances the CLI tool by replacing the existing dummy SVG output with a dynamically generated SVG plot. Instead of simply outputting static text, the tool now computes a basic line chart from the time series data (generated via the mathematical expression and range) and renders it as an SVG polyline.

## Overview

- When the CLI is invoked with an output file that does not end with ".csv", the tool will generate an SVG plot rather than a placeholder text SVG.
- The plot is constructed by transforming the time series data to fit within a fixed SVG viewport (e.g., 500x300 pixels with defined margins).
- A polyline is drawn to connect the computed data points, providing a visual representation of the function (e.g., sin(x) or cos(x)).

## Implementation Details

- **Source Code Modifications (src/lib/main.js):**
  - Update the non-CSV output branch. Instead of writing a dummy SVG with text elements, compute the time series data using the existing `generateTimeSeriesData` function.
  - Determine the minimum and maximum values for x and y from the generated data.
  - Define a fixed SVG viewport (e.g., width = 500, height = 300, margin = 20).
  - Transform each data point's x and y values into SVG coordinates using a linear scaling algorithm:
    - Compute scaled x: `plotX = margin + ((x - minX) / (maxX - minX)) * (width - 2 * margin)`
    - Compute scaled y: `plotY = height - margin - ((y - minY) / (maxY - minY)) * (height - 2 * margin)`
  - Generate a polyline element with the computed points and embed it within an `<svg>` container.
  - Write the resulting SVG content to the file specified by the CLI.

- **Testing Enhancements (tests/unit/main.test.js):**
  - Update the test case for SVG file generation. Instead of expecting a static dummy SVG string, the test will now verify that the written content contains an `<svg>` element and a `<polyline>` element.
  - Use string containment checks to ensure that the output includes the dynamically generated polyline and adheres to the expected structure.

- **Documentation Updates (README.md):**
  - Add a new section describing the SVG_PLOT feature. Explain that when a non-.csv file is provided via the `--file` flag, the CLI generates a basic line plot in SVG format from the computed time series data.
  - Provide a sample usage command, such as:
    ```sh
    node src/lib/main.js --expression "y=sin(x)" --range "x=-1:1" --file output.svg
    ```
  - Document the scaling and transformation logic used to map data points onto the SVG canvas.

## Conformance with Mission and Guidelines

- The enhancement strictly modifies the source, test, and documentation files without adding new files or altering unrelated functionality.
- It aligns with the mission of becoming a go-to plot library by providing immediate, graphical insights into formula visualisations.
- This feature is distinct and does not overlap with existing features (such as stats, diagnostics, or JSON export), making it a focused improvement in the plot generation capability.

## Summary

The SVG_PLOT feature transforms the output behavior of the CLI tool by converting computed time series data into a scalable SVG line plot using a polyline. This provides users with a visual, immediately interpretable plot of their mathematical expressions.
features/JSON_EXPORT.md
# features/JSON_EXPORT.md
# JSON_EXPORT Feature Enhancement

This update refines the JSON_EXPORT feature by adding support for exporting time series data in JSON format. When users specify an output file with a `.json` extension via the `--file` flag, the CLI tool will serialize the computed time series data into a formatted JSON string. This update complements existing CSV, SVG, and PNG export options and ensures that all supported export formats are available via the CLI.

## Overview

- **Objective:** Allow users to export the generated time series data in JSON format for programmatic consumption or further processing.
- **Benefit:** Provides an additional data export option that is especially useful for users who wish to integrate the generated data with other tools or systems.
- **Usage Example:**
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --file output.json
  ```

## Implementation Details

- **CLI Parameter Parsing:**
  - Extend the argument parsing in `src/lib/main.js` to check if the output file name ends with `.json`.
  - When the file extension is `.json`, the tool should generate the time series data using the existing `generateTimeSeriesData` function.

- **Data Serialization:**
  - Instead of generating CSV or graphical plots, serialize the data to JSON using `JSON.stringify(data, null, 2)` to produce a human-readable format.
  - Write the resulting JSON string to the specified output file using `fs.writeFileSync`.

- **Branching Logic in Main Function:**
  - If `outputFile.endsWith(".csv")`, maintain the current CSV generation workflow.
  - Else if `outputFile.endsWith(".json")`, generate the JSON output.
  - Else, continue with generating enhanced SVG/PNG plots as implemented.

## Testing Enhancements

- **Unit Tests:**
  - Update tests in `tests/unit/main.test.js` to include a scenario where the `--file` flag ends with `.json`.
  - Verify that the output file contains valid JSON starting with `{` and that all expected key-value pairings are present.

## Documentation Updates

- **README.md:**
  - Document the new `--file output.json` behavior and provide a usage example.
  - Explain that when a `.json` file is specified, the CLI tool writes a formatted JSON representation of the computed time series data.

## Conformance with Mission and Guidelines

- This enhancement provides additional export flexibility to the CLI tool, aligning with the mission of being the "jq of formulae visualisations." All changes are confined to the source, test, and README files, in full compliance with repository contribution guidelines.features/CONFIG_LOADER.md
# features/CONFIG_LOADER.md
# CONFIG_LOADER Feature Enhancement

This feature adds the ability to load configuration options from a YAML file via a new CLI flag (--config). When provided, the CLI will read the specified configuration file and merge its settings with other command-line arguments. This simplifies repeated invocation by allowing users to store their frequently used parameters in a configuration file. This enhancement adheres to the repository guidelines by modifying only the source, test, README, and dependencies file content.

## Overview

- Introduce a new optional flag `--config` that accepts a file path to a YAML configuration file.
- If the `--config` flag is provided, use the `js-yaml` library (already included as a dependency) to load the configuration.
- Merge the settings from the configuration file with direct CLI arguments, where CLI arguments override file settings.
- Provide clear error messages in case the YAML file cannot be read or parsed.

## Implementation Details

### Source Code Changes (src/lib/main.js)

- Update the main function to parse an additional `--config` flag from `process.argv`.
- If the flag is present, use `js-yaml` and Node's `fs` module to read and parse the YAML file.
- Merge the configuration object with the existing CLI arguments. For example, if the config file provides default values for `--expression`, `--range`, or `--file`, they should automatically be applied unless overridden by CLI.
- Ensure that error handling is in place: if the file does not exist or there is a YAML syntax error, print a clear error message and exit gracefully.

### Test Enhancements (tests/unit/main.test.js)

- Add test cases to simulate passing the `--config` flag with a sample YAML string. Stub the file reading process or provide a temporary file to validate that configuration values are correctly merged.
- Validate that when both a configuration file and direct CLI arguments are provided, the CLI arguments take precedence.
- Ensure tests cover scenarios where the configuration file is missing or contains invalid YAML.

### Documentation Updates (README.md)

- Update the README with a new section documenting the `--config` flag usage.
- Provide an example command such as:

```sh
node src/lib/main.js --config config.yaml
```

- Include a sample `config.yaml` snippet in the documentation:

```yaml
# config.yaml
expression: "y=sin(x)"
range: "x=-10:10, y=-1:1"
file: "output.svg"
```

### Dependency and Build Consistency

- No new dependencies are required since `js-yaml` is already a dependency.
- Ensure that file reading respects Node’s ESM standards.

## Conformance with Mission and Guidelines

- This enhancement supports the mission of making the CLI more user-friendly by reducing the need to repeatedly specify common parameters.
- All changes are confined to the source file, tests, and documentation, in compliance with repository guidelines.
features/LEGEND.md
# features/LEGEND.md
# LEGEND Feature Enhancement

This feature introduces a new CLI flag (`--legend`) to enable the inclusion of a legend in the generated plot outputs (SVG and PNG). When enabled, a legend box is rendered on the plot and displays descriptive text about the plotted data. The legend can either show a default label derived from the mathematical expression or a custom label provided by the user.

# Overview

- **Objective:** Provide users with a visual reference that identifies the data series in the plot. This is particularly useful when multiple expressions (or potential future upgrades) are introduced or when the default expression needs additional context.
- **Benefit:** Enhances plot interpretability and overall presentation. It becomes easy to understand what the plotted curve represents without consulting external documentation.
- **Usage Example:**
  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=0:6.28" --file output.svg --legend "Sine Wave"
  ```

# Implementation Details

- **CLI Parameter Parsing & Validation:**
  - Extend the argument parser in `src/lib/main.js` to include an optional parameter `--legend`. The value may be a string describing the legend text. If omitted, a default legend such as the expression itself (e.g., "y=sin(x)") will be used.
  - Validate that the legend text is a non-empty string if provided.

- **SVG/PNG Generation Updates:**
  - In the function that generates the SVG content (e.g., `generateSvgContent`), add logic toward the end to render a legend box. This may be implemented with an SVG `<rect>` element for background and a `<text>` element for the legend text.
  - Position the legend in a non-intrusive area (for example, the top-right corner) with a suitable offset from the margins.
  - Ensure that when converting the SVG to PNG (via sharp), the legend appears as expected.

- **Customization Options:**
  - Provide sensible defaults (e.g., default legend font size, color, and box background). Future iterations may allow these to be customized further via additional CLI options.

# Testing Enhancements

- **Source File Tests:**
  - Update tests in `tests/unit/main.test.js` to simulate invoking the CLI with the `--legend` flag.
  - Verify that the generated SVG content contains the legend group elements (e.g., `<rect>` and `<text>`) with the expected legend text.

- **Documentation Updates:**
  - Update `README.md` to document the new `--legend` CLI option with usage examples.

# Conformance with Mission and Guidelines

- **Repository Impact:** All changes are confined to existing source files, unit tests, and documentation, following the repository guidelines.
- **Mission Alignment:** This feature strengthens the mission to be the go-to plot library by making visual reports more self-contained and easier to interpret.
features/EXPRESSION_EVAL.md
# features/EXPRESSION_EVAL.md
# EXPRESSION_EVAL Feature Enhancement

This feature enhances the CLI tool by adding support for evaluating mathematical expressions provided through a new `--expression` flag. Along with an optional `--range` flag, the tool computes a series of y-values based on the provided function, offering users a preview of the data before plotting.

## Overview

- **Expression Parsing:** Parse the value from the `--expression` flag (e.g., "y=sin(x)") to determine the mathematical function.
- **Range Processing:** Optionally parse the `--range` flag (formatted as `x=start:end`) to set the domain over which x values will be generated. If absent, a default range is applied.
- **Evaluation:** Evaluate the mathematical expression using JavaScript's native Math functions. For example, if the expression is "y=sin(x)", compute y-values using `Math.sin(x)` over the determined range.
- **Integration:** The computed y-values are output to the console as a preview before proceeding with any plotting or exporting routines.

## Source Code Changes

- **Modify src/lib/main.js:**
  - Update the argument parsing logic to detect the `--expression` flag and optionally the `--range` flag.
  - Implement a simple parser that extracts the mathematical function from an expression starting with "y=". For instance, for "y=sin(x)", isolate the function body "sin(x)".
  - Generate a set of x values over a defined range (either provided via `--range` or using a default such as x in [-10, 10]).
  - Use JavaScript's `Math` functions to compute y-values for each x, and log the computed values along with basic statistics (min, max, average) if applicable.
  - Ensure the new logic does not interfere with existing flags like `--stats`, `--diagnostics`, and `--help`.

## Testing Enhancements

- **Update tests/unit/main.test.js:**
  - Add or extend tests to simulate CLI calls with the `--expression` flag (and optionally `--range`).
  - Verify that the console output includes the computed y-values for known expressions (e.g., validate that `Math.sin` applied over the given range yields correct results).
  - Check for proper handling and error messaging when the expression or range format is invalid.

## Documentation Updates

- **Update README.md:**
  - Include a dedicated section documenting the new `--expression` and `--range` flags.
  - Provide usage examples, such as:
    ```sh
    node src/lib/main.js --expression "y=sin(x)" --range "x=-10:10"
    ```
  - Outline expected outputs and potential error messages for invalid inputs.

## Dependency and Build Consistency

- No new dependencies are introduced. This feature solely utilizes JavaScript's built-in functionalities.
- All changes comply with Node 20, ECMAScript module standards, and adhere to the repository guidelines detailed in CONTRIBUTING.md and MISSION.md.
features/DATA_FILTER.md
# features/DATA_FILTER.md
# DATA_FILTER Feature Enhancement

This feature introduces a new `--filter` flag to the CLI tool that allows users to manipulate the computed time series data before plotting. Inspired by jq's data processing capabilities, the `--filter` flag accepts a simple filter expression to transform, reduce, or otherwise refine the generated data set.

## CLI Parameter Parsing & Validation

- Extend the CLI schema in `src/lib/main.js` to include a new optional string parameter `filter`.
- Use the existing `zod` validation framework to ensure that, if provided, the filter expression is a valid string.
- Update the help and usage output so that users are aware of the new flag.

## Implementation Details

- After evaluating the mathematical expression (e.g., via the `--expression` flag) and computing the time series data, check if a `--filter` flag is active.
- Implement a basic filter parser that supports simple conditions; for example, a filter expression like `gt:0;lt:1` where `gt` means greater than and `lt` means less than. This will allow the filtering of values (e.g., removing data points that do not meet the criteria).
- Apply the parsed filter conditions to the computed array of y-values before further processing (such as statistics computation, plotting, or file export).
- Ensure that if the provided expression does not match the expected format, the CLI returns a clear error message without disrupting normal operations.

## Test Enhancements

- Update the test suite in `tests/unit/main.test.js` to simulate CLI invocations that include the `--filter` flag.
- Verify that when a valid filter expression is provided, the computed data is correctly transformed and that the filtering logic produces the expected output.
- Add tests to cover edge cases where the filter expression is invalid or results in an empty data set, ensuring that proper error handling and messaging occur.

## Documentation Updates

- Update the `README.md` to document the new `--filter` flag. Include detailed instructions and examples in a new section describing the supported filter syntax.
- Provide example usage:

  ```sh
  node src/lib/main.js --expression "y=sin(x)" --range "x=-10:10" --filter "gt:0;lt:1" --file output.svg
  ```

- Explain that the filter will be applied to the computed y-values and can be used to narrow down the data set based on user-defined conditions.

## Conformance with Mission and Guidelines

- This feature adds achievable value by empowering users to refine the raw data before visualisation, aligning with the mission to be a "go-to plot library".
- All modifications remain confined to the source file, tests, and documentation, adhering to repository guidelines.
features/DIAGNOSTICS.md
# features/DIAGNOSTICS.md
# DIAGNOSTICS Feature Update

This feature introduces a new `--diagnostics` flag to the CLI tool. When enabled, the tool prints out important environmental and configuration details to help users and developers diagnose issues.

## Overview
- Enhance the CLI in `src/lib/main.js` to detect the `--diagnostics` flag among the command-line arguments.
- When `--diagnostics` is present, output diagnostic information including:
  - The current Node.js version (`process.version`).
  - The list of command-line arguments.
  - The version information from `package.json` (if accessible).
  - A summary of recognized CLI flags (e.g., `--stats`, `--expression`, `--range`, `--file`).
- Ensure that this diagnostic output does not interfere with the normal operation of other features.

## Implementation Details
### Source Code Changes (src/lib/main.js)
- Update the `main` function to check for the presence of `--diagnostics` in the argument list.
- If found, gather diagnostic data and print it to the console before executing the normal flow.
- Use simple checks and Node.js built-in methods (e.g., `process.version` and `process.argv`) to generate diagnostics.

### Test Enhancements (tests/unit/main.test.js)
- Add tests to simulate running the CLI with the `--diagnostics` flag. The tests should verify that the console output includes:
  - The Node.js version string.
  - The provided command-line arguments.
  - Any other expected diagnostic messages.

### Documentation Updates (README.md)
- Update the README to document the `--diagnostics` flag.
- Include usage examples, e.g.:
  ```sh
  node src/lib/main.js --diagnostics
  ```
  This command will produce a diagnostic report containing system and configuration details.

### Dependency File (package.json)
- No new dependencies are required for this feature.
- Optionally, update the `scripts` section to emphasize the existence of the diagnostics option (if not already documented).

## Conformance with Mission and Guidelines
- This feature strengthens our commitment to being a user-friendly tool and aligns with the mission of providing clear insights into the operations of the CLI.
- The changes are limited to the source file, test file, README file, and an optional minor update in the dependencies file, conforming to the repository guidelines.
